# Сборный проект 2
## Описание проекта
Заказчик этого исследования — сеть отелей **«Как в гостях»**. 

Чтобы привлечь клиентов, эта сеть отелей добавила на свой сайт возможность забронировать номер без предоплаты. Однако 
если клиент отменял бронирование, то компания терпела убытки. Сотрудники отеля могли, например, закупить продукты к
приезду гостя или просто не успеть найти другого клиента.

Чтобы решить эту проблему, вам нужно разработать систему, которая предсказывает отказ от брони. Если модель покажет, 
что бронь будет отменена, то клиенту предлагается внести депозит. **Размер депозита — 80%** от стоимости номера за одни 
сутки и затрат на разовую уборку. Деньги будут списаны со счёта клиента, если он всё же отменит бронь.


## Бизнес-метрика и другие данные
Основная бизнес-метрика для любой сети отелей — её прибыль. Прибыль отеля — это разница между стоимостью номера за все 
ночи и затраты на обслуживание: как при подготовке номера, так и при проживании постояльца. 

В отеле есть несколько типов номеров. В зависимости от типа номера назначается стоимость за одну ночь. Есть также 
затраты на уборку. Если клиент снял номер надолго, то убираются каждые два дня. 

### Стоимость номеров отеля:
* категория **A**: за ночь — **1 000**, разовое обслуживание — **400**;
* категория **B**: за ночь — **800**, разовое обслуживание — **350**;
* категория **C**: за ночь — **600**, разовое обслуживание — **350**;
* категория **D**: за ночь — **550**, разовое обслуживание — **150**;
* категория **E**: за ночь — **500**, разовое обслуживание — **150**;
* категория **F**: за ночь — **450**, разовое обслуживание — **150**;
* категория **G**: за ночь — **350**, разовое обслуживание — **150**.

В ценовой политике отеля используются сезонные коэффициенты: **весной и осенью цены повышаются на 20%, летом — на 40%**.

Убытки отеля в случае отмены брони номера — это стоимость одной уборки и одной ночи с учётом сезонного коэффициента.

На разработку системы прогнозирования заложен бюджет — **400 000**. При этом необходимо учесть, что внедрение модели 
должно окупиться за тестовый период. Затраты на разработку должны быть меньше той выручки, которую система принесёт 
компании.

## Инструкция по выполнению
### Шаг 1. Откройте файлы с данными
Пути к файлам: 
* `/datasets/hotel_train.csv` — данные для обучения модели.
* `/datasets/hotel_test.csv` — данные для тестирования модели.
### Шаг 2. Предобработка и исследовательский анализ данных
Проверьте данные и откорректируйте их, если потребуется.
Проведите исследовательский анализ представленных данных. Опишите найденные особенности: пропуски, выбросы.

Обзор данных показал, что **пропусков в данных не обнаружено.**

#### Была проделана работа с типами данных
1. строковые столбцы были переведены в категориальные и закодированы `label_encoder`
2. цело-числовые данные были переведены в булевые и числовые с меньшим расходованием памяти. 

#### Анализ данных с показал
1. `lead_time` -- количество дней между датой бронирования и датой прибытия имеет распределение Пуассона, были 
обнаружены аномальные значения которые составляли 0.8% от общего числа данных, аномальные значения не обрабатывал, 
тк они могут именть значение для определения отказа брони
2. `arrival_date_year` — год заезда. Информация есть только о заездах в 2015 и 2016 годах, 
причем данных за 2016 в 2.5 раза больше.
3. `arrival_date_week_number` — неделя заезда. Не учитывая первую (новогоднюю) неделю, похоже на нормальное
распределение данных
   * В первую неделю года очень много заездов, это связано с новогоднимим каникулами, я предполагаю
   * В 2 - 10 недели года, было меньше сего заездов, но был тренд на увеличение, 
   * с 10 по 35 неделю был плавный рост, 
   * с 35 по 40 наблюдался резкий рост, 
   * с 40 по 50 наблюдалось резкое снижение

4. `arrival_date_day_of_month` — день заезда. В среднем во все дни месяца было одинаковое число заездов, просадка есть 
только за 31 число (потому что не во всех месяцах есть 31 день)
5. `stays_in_weekend_nights` — количество ночей в выходные дни. Номера бронировали максимум на 4 ночи в выходные дни, 
в среднем (медиана) бронировали на одну ночь
6. `stays_in_week_nights` — количество ночей в будние дни. Похоже на нормальное распредение данных, 
медиана 2 ночи в буднии дни
7. `adults` — количество взрослых постояльцев. Данные имеют номальное распределение, 
медиана двое взрослых в номере, максимум 4
8. `children` — количество детей от 3 до 14 лет. Данные имеют распределение Пуассона, медиана 0 и максимум 3. 
Чаще всего номера бронируют без детей.
9. `babies` — количество младенцев. Данные имеют распределение Пуассона, медиана 0 и максимум 10. 
Чаще всего номера бронируют без младенцев. Но 10 младенцев в одном номере похоже на выброс, заменил медианой.
10. `previous_cancellations` — количество отменённых заказов у клиента. Большинство клиентов не имеют отменненых 
заказов, но учитывая что большинство бронирований происходят в первый раз, это значит что статистика по нулевым отменам,
зависит от количество отменённых заказов у клиента
11. `previous_bookings_not_canceled` — количество подтверждённых заказов у клиента. Большьшинство клиентов бронируют 
номер в первый рах, подтверждение
12. `booking_changes` — количество изменений параметров заказа. Распределение ранных Пауссона, 
большинство гостей не вносят изменения в заказ
13. `days_in_waiting_list` — сколько дней заказ ожидал подтверждения. Распределение данных Пуассона, большинство
заказов подтверждаются в день оформления6 но есть выбросы, подтверждение через 259 это сильно)
14. `required_car_parking_spaces` — необходимость места для автомобиля. Большинству гостей не нужно парковочное место
15. `total_of_special_requests` — количество специальных отметок. Распределение данных Пуассона, медиана = 0, максимум 
6 отметок
16. `total_nights` — общее количество ночей, Похоже на нормальное распределение, со смещением в лево, медиана 3 ночи,
максимум 10 ночей
### Шаг 3. Вычислите бизнес-метрику
Оцените прибыль отеля без внедрения депозитов.
Прибль Отеля за два года = 66'150'370 рублей
### Шаг 4. Разработка модели ML
Обучите разные модели и оцените их качество кросс-валидацией. Выберите лучшую модель и проверьте её на тестовой выборке.

Опишите выводы.

Выберите метрику для обучения. Перед нами стоит задача минимизировать убытки, это значит что нужно выявлять как можно 
большше стучаев отказа от брони, таким оброзом в качестве основной метрики сы выберем recall, она определеяет какую 
долю объектов положительного класса из всех объектов положительного класса нашёл алгоритм.

Оцените прибыль, которую принесёт выбранная модель за год.

Прибль за 8 месяцев на тестовых данных = 32'582'920 рублей
Сверх Прибль за 8 месяцев после внедрения = 8'139'932 рублей
### Шаг 5. Выявите признаки «ненадёжного» клиента
На основе исследовательского анализа данных опишите клиента, склонного к отказу от брони.

На графике “важность признаков” мы видим
1. Самый важный признак - previous_cancellations — количество отменённых заказов у клиента;
2. country — гражданство постояльца
3. Наличние детей
4. Месяц бронирования
### Шаг 6. Напишите общий вывод
Мною были проанализированные данные, истории бронированя в сети отелей «Как в гостях». 
Пропусков в данных не было обнаружено.

Расчеты дохода отеля на 2 года (2015-2016) показали что, прибль = 70 689 960 рублей,

Перед нами стоит задача минимизировать убытки, это значит что нужно выявлять как можно большше стучаев отказа от брони,
таким оброзом в качестве основной метрики сы выберем recall, она определеяет какую долю объектов положительного класса 
из всех объектов положительного класса нашёл алгоритм.
Протестировано 3 модели машинного обучения, на валидационных данных были получены следующие результаты:
1. Логистическая регрессия **recall = 0.2**
2. RandomForest **recall = 0.03**

На тестовых данных, _Логистическая_ регрессия показала следующие результаты **recall = 0.44**, результаты оказались не 
впечатляющими, но даже с ними получилось добыиться роста бизнес метрики - прибыли. 

* Прибль за 8 месяцев на тестовых данных = **32 582 920 рублей**
* Сверх прибль за 8 месяцев после внедрения = **8 139 932 рублей**

Являются одиними из признаков отмены брони, на первый взгляд
## Описание данных
### В таблицах `hotel_train` и `hotel_test` содержатся одинаковые столбцы:
* `id` — номер записи;
* `adults` — количество взрослых постояльцев;
* `arrival_date_year` — год заезда;
* `arrival_date_month` — месяц заезда;
* `arrival_date_week_number` — неделя заезда;
* `arrival_date_day_of_month` — день заезда;
* `babies` — количество младенцев;
* `booking_changes` — количество изменений параметров заказа;
* `children` — количество детей от 3 до 14 лет;
* `country` — гражданство постояльца;
* `customer_type` — тип заказчика:
* `Contract` — договор с юридическим лицом;
* `Group` — групповой заезд;
* `Transient` — не связано с договором или групповым заездом;
* `Transient-party` — не связано с договором или групповым заездом, но связано с бронированием типа Transient.
* `days_in_waiting_list` — сколько дней заказ ожидал подтверждения;
* `distribution_channel` — канал дистрибуции заказа;
* `is_canceled` — отмена заказа;
* `is_repeated_guest` — признак того, что гость бронирует номер второй раз;
* `lead_time` — количество дней между датой бронирования и датой прибытия;
* `meal` — опции заказа:
  * `SC` — нет дополнительных опций; 
  * `BB` — включён завтрак;
  * `HB` — включён завтрак и обед;
  * `FB` — включён завтрак, обед и ужин.
* `previous_bookings_not_canceled` — количество подтверждённых заказов у клиента; 
* `previous_cancellations` — количество отменённых заказов у клиента; 
* `required_car_parking_spaces` — необходимость места для автомобиля; 
* `reserved_room_type` — тип забронированной комнаты; 
* `stays_in_weekend_nights` — количество ночей в выходные дни; 
* `stays_in_week_nights` — количество ночей в будние дни; 
* `total_nights` — общее количество ночей; 
* `total_of_special_requests` — количество специальных отметок.